
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Dashboard S·ªë nh√† t·ªânh B·∫Øc Giang</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background-color: #f8f9fa; }
    #map { height: 400px; }
    .table-responsive { max-height: 400px; overflow-y: auto; }
  </style>
</head>
<body class="container my-4">
  <h2 class="text-center mb-3">üìç DASHBOARD S·ªê NH√Ä TO√ÄN T·ªàNH B·∫ÆC GIANG</h2>
  <p class="text-center text-muted mb-4">C·∫≠p nh·∫≠t d·ªØ li·ªáu s·ªë h√≥a s·ªë nh√† qua d·ªØ li·ªáu JSON</p>

  <h4>I. T·ªïng quan to√†n t·ªânh</h4>
  <table class="table table-bordered table-sm w-auto mb-4">
    <thead class="table-light">
      <tr><th>Ch·ªâ ti√™u</th><th>Gi√° tr·ªã</th><th>Ghi ch√∫</th></tr>
    </thead>
    <tbody id="summaryTableBody">
      <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c ch√®n ƒë·ªông -->
    </tbody>
  </table>

  <div class="row mb-5">
    <div class="col-md-6">
      <canvas id="barChart"></canvas>
    </div>
    <div class="col-md-6">
      <canvas id="pieChart"></canvas>
    </div>
  </div>

  <h4>II. B·ªô l·ªçc ƒë·ªãa b√†n</h4>
  <div class="row mb-4">
    <div class="col-md-4 mb-2">
      <label for="huyenSelect" class="form-label">Ch·ªçn huy·ªán:</label>
      <select id="huyenSelect" class="form-select">
        <option value="all">T·∫•t c·∫£</option>
      </select>
    </div>
    <div class="col-md-4 mb-2">
      <label for="xaSelect" class="form-label">Ch·ªçn x√£/ph∆∞·ªùng:</label>
      <select id="xaSelect" class="form-select">
        <option value="all">T·∫•t c·∫£</option>
      </select>
    </div>
  </div>

  <h4>III. B·∫£ng chi ti·∫øt theo x√£/ph∆∞·ªùng</h4>
  <div class="table-responsive mb-4">
    <table id="detailTable" class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>Huy·ªán</th><th>X√£/Ph∆∞·ªùng</th><th>T·ªïng s·ªë b·∫£n ghi</th>
          <th>Thi·∫øu CCCD</th><th>Thi·∫øu Ch·ªß h·ªô</th><th>Thi·∫øu c·∫£ hai</th><th>T·ª∑ l·ªá thi·∫øu CCCD (%)</th>
        </tr>
      </thead>
      <tbody id="detailTableBody">
        <!-- D·ªØ li·ªáu ƒë·ªông -->
      </tbody>
      <tfoot class="table-light fw-bold">
        <tr>
          <td colspan="2">T·ªïng c·ªông</td>
          <td id="totalTongSo"></td>
          <td id="totalThieuCCCD"></td>
          <td id="totalThieuChuHo"></td>
          <td id="totalThieuCaHai"></td>
          <td id="totalTyLeThieuCCCD"></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <footer class="text-center text-muted mb-4">
    ¬© Trung t√¢m D·ªØ li·ªáu ‚Äì S·ªü X√¢y d·ª±ng t·ªânh B·∫Øc Giang
  </footer>

  <script>
    // ƒê·ªçc d·ªØ li·ªáu JSON
    fetch('data_sonha.json')
      .then(res => res.json())
      .then(data => {
        // T·∫°o danh s√°ch Huy·ªán v√† X√£
        const huyenSet = new Set();
        const xaTheoHuyen = {};
        data.forEach(item => {
          huyenSet.add(item.Huyen);
          if (!xaTheoHuyen[item.Huyen]) xaTheoHuyen[item.Huyen] = new Set();
          xaTheoHuyen[item.Huyen].add(item.XaPhuong);
        });

        // ƒêi·ªÅn dropdown Huy·ªán
        const huyenSelect = document.getElementById('huyenSelect');
        huyenSet.forEach(h => {
          const opt = document.createElement('option');
          opt.value = h; opt.textContent = h;
          huyenSelect.appendChild(opt);
        });

        // Function c·∫≠p nh·∫≠t dropdown X√£
        function updateXaOptions() {
          const huyen = huyenSelect.value;
          const xaSelect = document.getElementById('xaSelect');
          xaSelect.innerHTML = '<option value="all">T·∫•t c·∫£</option>';
          if (huyen !== 'all') {
            xaTheoHuyen[huyen].forEach(x => {
              const opt = document.createElement('option');
              opt.value = x; opt.textContent = x;
              xaSelect.appendChild(opt);
            });
          }
        }

        huyenSelect.addEventListener('change', () => {
          updateXaOptions();
          renderDetailTable();
          renderCharts();
          renderSummary();
        });

        // X·ª≠ l√Ω khi ch·ªçn X√£
        document.getElementById('xaSelect').addEventListener('change', () => {
          renderDetailTable();
        });

        // H√†m t√≠nh v√† hi·ªÉn th·ªã t·ªïng quan to√†n t·ªânh
        function renderSummary() {
          const summaryBody = document.getElementById('summaryTableBody');
          summaryBody.innerHTML = '';
          const selectedHuyen = huyenSelect.value;
          let filtered = data;
          if (selectedHuyen !== 'all') {
            filtered = filtered.filter(d => d.Huyen === selectedHuyen);
          }
          // T√≠nh t·ªïng
          const soXa = new Set(filtered.map(d => d.XaPhuong)).size;
          const tongHo = filtered.reduce((sum, d) => sum + d.TongSo, 0);
          const thieuCCCD = filtered.reduce((sum, d) => sum + d.ThieuCCCD, 0);
          const thieuChuHo = filtered.reduce((sum, d) => sum + d.ThieuChuHo, 0);
          const thieuCaHai = filtered.reduce((sum, d) => sum + d.ThieuCaHai, 0);
          const tyLe = tongHo ? ((thieuCCCD / tongHo) * 100).toFixed(1) + '%' : '0%';

          const rows = [
            ['S·ªë x√£/ph∆∞·ªùng ƒë√£ c√≥ d·ªØ li·ªáu', soXa, ''],
            ['T·ªïng s·ªë b·∫£n ghi', tongHo, ''],
            ['S·ªë b·∫£n ghi thi·∫øu CCCD', thieuCCCD, ''],
            ['S·ªë b·∫£n ghi thi·∫øu Ch·ªß h·ªô', thieuChuHo, ''],
            ['S·ªë b·∫£n ghi thi·∫øu c·∫£ hai', thieuCaHai, ''],
            ['T·ª∑ l·ªá thi·∫øu CCCD', tyLe, '']
          ];
          rows.forEach(r => {
            const tr = document.createElement('tr');
            r.forEach(cell => {
              const td = document.createElement('td');
              td.textContent = cell;
              tr.appendChild(td);
            });
            summaryBody.appendChild(tr);
          });
        }

        // H√†m hi·ªÉn th·ªã b·∫£ng chi ti·∫øt
        function renderDetailTable() {
          const tbody = document.getElementById('detailTableBody');
          tbody.innerHTML = '';
          const selectedHuyen = huyenSelect.value;
          const selectedXa = document.getElementById('xaSelect').value;
          let filtered = data;
          if (selectedHuyen !== 'all') filtered = filtered.filter(d => d.Huyen === selectedHuyen);
          if (selectedXa !== 'all') filtered = filtered.filter(d => d.XaPhuong === selectedXa);

          let totalTongSo = 0, totalThieuCCCD = 0, totalThieuChuHo = 0, totalThieuCaHai = 0;
          filtered.forEach(d => {
            const tr = document.createElement('tr');
            ['Huyen', 'XaPhuong', 'TongSo', 'ThieuCCCD', 'ThieuChuHo', 'ThieuCaHai', 'TyLeThieuCCCD'].forEach(key => {
              const td = document.createElement('td');
              td.textContent = d[key];
              tr.appendChild(td);
            });
            tbody.appendChild(tr);
            totalTongSo += d.TongSo;
            totalThieuCCCD += d.ThieuCCCD;
            totalThieuChuHo += d.ThieuChuHo;
            totalThieuCaHai += d.ThieuCaHai;
          });

          document.getElementById('totalTongSo').textContent = totalTongSo;
          document.getElementById('totalThieuCCCD').textContent = totalThieuCCCD;
          document.getElementById('totalThieuChuHo').textContent = totalThieuChuHo;
          document.getElementById('totalThieuCaHai').textContent = totalThieuCaHai;
          document.getElementById('totalTyLeThieuCCCD').textContent = totalTongSo ? ((totalThieuCCCD / totalTongSo) * 100).toFixed(1) + '%' : '0%';
        }

        // H√†m v·∫Ω bi·ªÉu ƒë·ªì
        let barChart, pieChart;
        function renderCharts() {
          const selectedHuyen = huyenSelect.value;
          let filtered = data;
          if (selectedHuyen !== 'all') {
            filtered = filtered.filter(d => d.Huyen === selectedHuyen);
          }
          // Bi·ªÉu ƒë·ªì c·ªôt theo Huy·ªán
          const huyenList = Array.from(huyenSet);
          const barData = huyenList.map(h => {
            const arr = data.filter(d => d.Huyen === h);
            const tong = arr.reduce((sum, d) => sum + d.TongSo, 0);
            const thieu = arr.reduce((sum, d) => sum + d.ThieuCCCD, 0);
            return tong ? ((thieu / tong) * 100).toFixed(1) : 0;
          });
          if (barChart) barChart.destroy();
          barChart = new Chart(document.getElementById('barChart'), {
            type: 'bar',
            data: {
              labels: huyenList,
              datasets: [{
                label: '% Thi·∫øu CCCD theo huy·ªán',
                data: barData,
                backgroundColor: '#0d6efd'
              }]
            },
            options: {
              scales: { y: { beginAtZero: true, max: 100 } }
            }
          });

          // Bi·ªÉu ƒë·ªì tr√≤n to√†n t·ªânh ho·∫∑c theo Huy·ªán
          const total = filtered.reduce((sum, d) => sum + d.TongSo, 0);
          const totalThieu = filtered.reduce((sum, d) => sum + d.ThieuCCCD, 0);
          if (pieChart) pieChart.destroy();
          pieChart = new Chart(document.getElementById('pieChart'), {
            type: 'pie',
            data: {
              labels: ['Thi·∫øu CCCD', 'ƒê·ªß CCCD'],
              datasets: [{
                data: [totalThieu, total - totalThieu],
                backgroundColor: ['#dc3545', '#198754']
              }]
            },
            options: {
              plugins: {
                title: {
                  display: true,
                  text: selectedHuyen === 'all' ? 'T·ª∑ l·ªá thi·∫øu CCCD to√†n t·ªânh' : 'T·ª∑ l·ªá thi·∫øu CCCD t·∫°i ' + selectedHuyen
                }
              }
            }
          });
        }

        // Kh·ªüi t·∫°o
        updateXaOptions();
        renderSummary();
        renderDetailTable();
        renderCharts();
      })
      .catch(err => console.error('L·ªói t·∫£i d·ªØ li·ªáu:', err));
  </script>
</body>
</html>
